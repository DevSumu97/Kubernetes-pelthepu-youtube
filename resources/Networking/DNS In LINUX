DNS In LINUX
/etc/hosts  /etc/resolv.conf -nameserver  192.168.1.100  /etc/nsswitch.conf.

We have two computers, A and B, both part of the same network, and they've been assigned with IP addresses 192.168.1.10 and 192.168.1.11
You're able to ping one computer from the other using the other computer's IP address. You know that system B has database services on them.
So instead of having to remember the IP address of system B, you decide to give it a name DB.
Going forward, you would like to ping system B using the name db instead of its IP address.
If you try to ping DB now, you would see that host A is unaware of a host named DB.

So how do you fix that?

Basically, you want to tell system A that system B at IP address 192.168.1.11 has a name DB.
We want to tell system A that when I say db, I mean the IP 192.168.1.11
You can do that by adding an entry into the /etc/hosts file on system A, mention the IP address and the name you want your host to see System B,
as we told system A that the IP at 192.168.1.11 is a host named DB.
Pings to DB Now gets sent to the correct IP and are successful.

vi /etc/hosts => 
192.168.1.11 	db

Now there is an important point to note here.
We told system A that the IP at 192.168.1.11 is a host named DB host A takes that for granted.
Whatever we put in the/etc/hosts file is the source of truth for host A, but that need not be the truth.
Host A does not check to make sure if system B is actual name is db.
For instance, running a "hostname" command on system B reveals that it is named "host-2", but host A doesn't care.
It goes by what's in the host file. You can even fool system A to believing that system B is Google.
Just add an entry into the host file with an IP mapping to google.com.

vi /etc/hosts => 
192.168.1.11 	db
192.168.1.11 	www.google.com

Then ping Google and you will get a response from system B.
So we have two names pointing to the same system. One as DB and another as Google. And we can use either names to reach system B.
You can have as many names as you want for as many servers as you want in the /etc/hosts file.
Every time we reference another host by its name from host A through a ping command or SSH command, or through any of the applications or tools
within this system, it looks into its /etc/hosts to find out the IP address of that host.
Translating host name to IP address this way is known as NAME RESOLUTION.

Within a small network of few systems, you can easily get away with the entries in the /etc/hosts file On each system,
I specify which are the other systems in the environment, and that's how it was done in the past.

vi /etc/hosts => 
192.168.1.11 	db
192.168.1.12	data
192.168.1.13 	nfs
192.168.1.14    web 

DIFFICULTY in this System

Until the environment grew and these files got filled with too many entries, and managing these became too hard.
If one of the server's IP changed, you would need to modify the entries in all of these hosts.
And that's where we decided to move all these entries into a single server who will manage it centrally.
We call that our "DNS SERVER", and then we point all hosts to lookup that server. 
If they need to resolve a hostname to an IP address instead of its own /etc/host files.

So how do we do that?

How do we point our host to a DNS server?
Our DNS SERVER has the IP 192.168.1.100.
Every host has a DNS resolution configuration file at /etc/resolv.conf.
You add an entry into it specifying the address of the DNS server.
We say name server and point it to 192.168.1.100. And that should be it.

vi /etc/resolv.conf.
nameserver  192.168.1.100


Once this is configured on all of your hosts, every time a host comes up across a hostname that it does not know about, it looks it up from the DNS server.
If the IP of any of the host was to change, simply update the DNS server and all hosts should resolve the new IP address going forward.
You no longer need any entries in the /etc/hosts file in any of the hosts, but that does not mean you can't have entries in host file.You still can.

For example, say you were to provision a test server for your own needs.
You don't think others would need to resolve the server by its name, so it need not be added to the DNS server.
In that case, you can add an entry into your /etc/hosts file to resolve this server.
You can now resolve the server, however, no other system will be able to do that.
So a system is able to use hostname to IP mapping from the /etc/hosts file locally, as well as from a remote DNS server.

What if you have an entry in both places, one in your /etc/host file and another in DNS Server?
I have an entry in my local file set to 192.168.1.115, and someone added an entry for the same host to 192.168.1.116 on the DNS server.
In that case, the host first looks in the local /etc/host file and then looks at the name server.
So if it finds the entry in the local /etc/hosts file, it uses that.
If not, it looks for that host in the DNS server, but that ORDER can be changed.
The order is defined by an entry in the file /etc/nsswitch.conf  in the line with the hosts entry.

/etc/hosts 
192.168.1.115.  test

Entry in DNS SERVER
192.168.1.116.  test

cat /etc/nsswitch.conf
hosts :  files dns


As you can see, the order is first files and then followed by DNS. 
files rfers to /etc/hosts file and dns refers to the DNS server.
So for every host name, the host first looks into the /etc/hosts file, and if it cannot find it there,it then looks at the DNS server.
This order can be modified by editing this entry in the /etc/nsswitch.conf.
As per this order Our host would resolve the test server to 192.168.1.115. from /etc/hosts file



What if you try to ping a server that is not in either list?
For example, I try and ping facebook.com.
I don't have facebook.com in my /etc/hosts file, and I don't have it in my DNS server either.
So in that case it will fail.
You can add another entry into your /etc/resolv.conf file to point to a Nameserver that knows facebook.com.


cat /etc/resolv.conf.
nameserver  192.168.1.100 (DNS SERVER)
nameserver  8.8.8.8


For example, 8.8.8.8 is a common, well-known public name server available on the internet, hosted by Google that knows about all websites on the internet.
You can have multiple name servers like this configured on your host, but then you will have to configure that on all your hosts in your network.

You already have a name server within your network configured on all the hosts. So in that case, you can configure the DNS server itself to forward 
any unknown host names to the public name server on the internet. 

-------------------------------------------
Entry in nameserver  192.168.1.100 (DNS SERVER)
192.168.1.116.  test
Forward ALL to  8.8.8.8
-------------------------------------------

You should now be able to ping external sites such as facebook.com.

Until now, we've been just trying to reach systems with their names like web DB, NFS, etc. but we just try to ping Facebook at www.facebook.com.

What is this name with the w-w-w and .com at the end it's called a domain name, and it is how IP's translate to names that we can remember on the
public internet, just like how we did for our hosts.

Now, the reason they are in this format, separated by dots, is to group like things together.

The last portion of the domain name, the .coms, the .net, .edu, .org, etc. are the top level domains that represent the intent of the website

.com for commercial or general purpose
.net for network
.edu for educational organizations and for non-profit organizations.


Let's look at one in particular.
In Google's case, the dot (.)is the root.That's where everything starts.
.com is the top level domain.
Google is the domain name assigned to Google
w-w-w is a subdomain.


root               					=> .
top level domain   					=> .com
omain name assigned to Google       => google
subdomain                           => www,aaps,drive,mail

The subdomains help in further grouping things together under Google.
For example, 

# Google's map service is available at maps.google.com, so maps is a subdomain.
# Google's storage service is available at drive.google.com.
# Mobile apps are available at aaps.google.com.
# Google's email service are available at mail.google.com.

You can further divide each of these into as many subdomains based on your needs.So you begin to see a tree structure forming.

When you try to reach any of these domain names, say aaps.google.com.
From within your organization, your request first hits your organization's internal DNS server.
It doesn't know who apps or Google is, so it forwards your request to the internet.

On the internet, the IP address of the server serving aaps.google.com may be resolved with the help of multiple DNS servers.
A ROOT DNS server looks at your request and points you to a DNS server Serving .com.
A .com DNS server looks at your request and forwards you to Google, and Google's DNS server provides you the IP of the server serving the apps applications.

	aaps.google.com
	      V
	   Org DNS
		  V
	   Root DNS
	      V
	   .com DNS
	      V
	  Google DNS
	      V
	216.58.221.78
	
In order to speed up all future results, your organization's DNS server may choose to cache this IP 216.58.221.78 for a period of time, typically few seconds
up to few minutes. That way, it doesn't have to go through the whole process again each time. 


So that was out in the public.What about your organization?

Your organization can have a similar structure too.

For example, your organization could be called as my company.com and have multiple subdomains for each purpose.

The w-w-w for external facing website.
mail.mycompany.com for accessing your organizations mail
drive.mycompany.com for accessing storage.
pay.mycompany.com for accessing the payroll application,
hr.mycompany.com for accessing HR application, etc..

All of these are configured in your organization's internal DNS server.
The reason we discussed all of this is to understand another entry in the /etc/resolv.conf file.
Remember, this is the file where we configured the DNS server to be used for our host.
With that, we were able to resolve servers in your organization with just their names like web.
We have now introduced more standard domain names like web.mycompany.com or mycompany.com, etc.
now when you ping web, you can no longer get a response. Of course, this is because we are trying to ping web, but there is no record for by the name web on
my DNS server. Instead it is web.company.com so you have to use web.mycompany.com.

Now I can understand if someone outside our company wants to access our web server. He would have to use web.mycompany.com.
But within our company, your own company, you want to simply address the web server by its first name,web.

Just like how you address other members in your family simply by their first names, which is not the case when someone outside your family addresses them 
using their full names.

So what do you do to configure web?
To resolve web.mycompany.com.
You want to say when I say web, I mean web.mycompany.com.
For that, you make an entry into your host's /etc/resolv.conf file called search and specify the domain name you want to append.

cat /etc/resolv.conf.
nameserver  192.168.1.100 (DNS SERVER)
search      mycompany.com  prod.mycompany.com 

Next time you try to ping web, you will see it actually tries web.mycompany.com.

Now your host is intelligent enough to exclude the search-domain. (mycompany.com)  If you specified a domain in your query like this (curl web.mycompany.com)
you may also provide additional search domains like this (prod.mycompany.com)

So it would mean.

When I say web, I mean web.mycompany.com or web.prod.mycompany.com.
So your host would try searching all of these domain names when you look for a host name.

Finally, a word about a record types.
So how were the records stored in the DNS server?

We know that it stores 
IPv4 to host names. That's known as A records.
Storing IPv6 to host names is known as AAAA records mapping.
One name to another name is called CNAME records.

For example, you may have multiple aliases for the same application, like a food delivery service may also be reached at eat or hungry.
That's where a CNAME record is used. Name to name mapping.

================================================================

Now, ping may not always be the right tool to test DNS resolution.

nslookup

There are a few other tools as well, such as Nslookup. You can use nslookup to query a hostname from a DNS server.
But remember Nslookup does not consider the entries in the local /etc/hosts file.
So if you add an entry into the local /etc/hosta file for your web application, and if you try to do an nslookup for that web application, 
it is not going to find it.
The entry for your web application has to be present in your DNS server.
Nslookup only queries the DNS server.


dig

The same goes with dig.
Dig is another useful tool to test DNS name resolution.
It returns more details in a similar form as is stored on the server.



